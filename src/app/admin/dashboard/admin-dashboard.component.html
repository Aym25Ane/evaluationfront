<div class="min-h-screen bg-slate-50 py-8 font-sans">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

    <!-- ================= HEADER ================= -->
    <div class="md:flex md:items-center md:justify-between mb-8">
      <div class="min-w-0 flex-1">
        <h2 class="text-2xl font-bold leading-7 text-slate-900 sm:truncate sm:text-3xl sm:tracking-tight">
          Tableau de Bord
        </h2>
        <p class="mt-1 text-sm text-slate-500">
          Gérez vos formations, analysez les revenus et suivez la progression des étudiants.
        </p>
      </div>
<!--      <div class="mt-4 flex md:ml-4 md:mt-0">-->
<!--        <button (click)="editFormation(0)"-->
<!--                class="inline-flex items-center rounded-xl bg-indigo-600 px-4 py-2.5 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600 transition-all active:scale-95">-->
<!--          <svg class="-ml-0.5 mr-1.5 h-5 w-5" viewBox="0 0 20 20" fill="currentColor">-->
<!--            <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />-->
<!--          </svg>-->
<!--          Nouvelle Formation-->
<!--        </button>-->
<!--      </div>-->
    </div>

    <!-- ================= LOADING STATE ================= -->
    <div *ngIf="isLoading()" class="flex flex-col items-center justify-center h-64 space-y-4">
      <div class="w-12 h-12 border-4 border-indigo-200 border-t-indigo-600 rounded-full animate-spin"></div>
      <p class="text-slate-400 font-medium">Chargement des données...</p>
    </div>

    <div *ngIf="!isLoading()" class="space-y-8 animate-fade-in-up">

      <!-- ================= KPIS CARDS ================= -->

      <div class="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4">

        <!-- Card 1: Etudiants -->
        <div class="bg-white rounded-2xl p-5 shadow-sm ring-1 ring-slate-900/5 flex items-center gap-4 hover:shadow-md transition-shadow">
          <div class="flex-shrink-0 p-3 rounded-xl bg-blue-50 text-blue-600">
            <!-- Icone -->
            <svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z" />
            </svg>
          </div>
          <div>
            <p class="text-sm font-medium text-slate-500">Total Apprenants</p>
            <p class="text-2xl font-bold text-slate-900 mt-1">{{ globalStats().totalEtudiants | number }}</p>
          </div>
        </div>

        <!-- Card 2: Revenus -->
        <div class="bg-white rounded-2xl p-5 shadow-sm ring-1 ring-slate-900/5 flex items-center gap-4 hover:shadow-md transition-shadow">
          <div class="flex-shrink-0 p-3 rounded-xl bg-emerald-50 text-emerald-600">
            <!-- Icone -->
            <svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m-3-2.818l.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
          <div>
            <p class="text-sm font-medium text-slate-500">Chiffre d'Affaires</p>
            <p class="text-2xl font-bold text-slate-900 mt-1">{{ globalStats().totalRevenus | currency:'EUR':'symbol':'1.0-0' }}</p>
          </div>
        </div>

        <!-- Card 3: Formations -->
        <div class="bg-white rounded-2xl p-5 shadow-sm ring-1 ring-slate-900/5 flex items-center gap-4 hover:shadow-md transition-shadow">
          <div class="flex-shrink-0 p-3 rounded-xl bg-violet-50 text-violet-600">
            <!-- Icone -->
            <svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" />
            </svg>
          </div>
          <div>
            <p class="text-sm font-medium text-slate-500">Cours Actifs</p>
            <p class="text-2xl font-bold text-slate-900 mt-1">
              {{ globalStats().formationsActives }} <span class="text-sm font-normal text-slate-400">/ {{ formations().length }}</span>
            </p>
          </div>
        </div>

        <!-- Card 4: Note -->
        <div class="bg-white rounded-2xl p-5 shadow-sm ring-1 ring-slate-900/5 flex items-center gap-4 hover:shadow-md transition-shadow">
          <div class="flex-shrink-0 p-3 rounded-xl bg-amber-50 text-amber-500">
            <!-- Icone -->
            <svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z" />
            </svg>
          </div>
          <div>
            <p class="text-sm font-medium text-slate-500">Satisfaction</p>
            <p class="text-2xl font-bold text-slate-900 mt-1">
              {{ globalStats().noteGlobale | number:'1.1-1' }}<span class="text-sm text-slate-400">/5</span>
            </p>
          </div>
        </div>

      </div>

      <!-- ================= TOOLBAR & FILTERS ================= -->
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 bg-white p-2 rounded-2xl shadow-sm border border-slate-100">

        <!-- Search -->
        <div class="relative flex-grow max-w-md">
          <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
            <svg class="h-5 w-5 text-slate-400" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd" />
            </svg>
          </div>
          <input type="text"
                 [ngModel]="searchQuery()"
                 (ngModelChange)="searchQuery.set($event)"
                 class="block w-full rounded-xl border-0 py-2.5 pl-10 text-slate-900 ring-1 ring-inset ring-slate-200 placeholder:text-slate-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6 bg-slate-50"
                 placeholder="Rechercher une formation, une catégorie...">
        </div>

        <!-- Filter Tabs -->
        <div class="flex space-x-1 bg-slate-100 p-1 rounded-xl">
          <button (click)="filterStatus.set('TOUS')"
                  [class.bg-white]="filterStatus() === 'TOUS'"
                  [class.shadow]="filterStatus() === 'TOUS'"
                  [class.text-indigo-600]="filterStatus() === 'TOUS'"
                  class="rounded-lg px-4 py-2 text-sm font-medium text-slate-600 hover:text-indigo-600 transition-all">
            Tout
          </button>
          <button (click)="filterStatus.set('PUBLIE')"
                  [class.bg-white]="filterStatus() === 'PUBLIE'"
                  [class.shadow]="filterStatus() === 'PUBLIE'"
                  [class.text-emerald-600]="filterStatus() === 'PUBLIE'"
                  class="rounded-lg px-4 py-2 text-sm font-medium text-slate-600 hover:text-emerald-600 transition-all flex items-center gap-1">
            <span class="w-2 h-2 rounded-full bg-emerald-500"></span> Publiés
          </button>
          <button (click)="filterStatus.set('BROUILLON')"
                  [class.bg-white]="filterStatus() === 'BROUILLON'"
                  [class.shadow]="filterStatus() === 'BROUILLON'"
                  [class.text-amber-600]="filterStatus() === 'BROUILLON'"
                  class="rounded-lg px-4 py-2 text-sm font-medium text-slate-600 hover:text-amber-600 transition-all flex items-center gap-1">
            <span class="w-2 h-2 rounded-full bg-amber-500"></span> Brouillons
          </button>
        </div>
      </div>

      <!-- ================= TABLE ================= -->
      <div class="overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-sm">
        <div class="overflow-x-auto">
          <table class="min-w-full text-left text-sm whitespace-nowrap">
            <thead class="bg-slate-50 text-slate-500">
            <tr>
              <th scope="col" class="px-6 py-4 font-semibold uppercase tracking-wider text-xs">Formation</th>
              <th scope="col" class="px-6 py-4 font-semibold uppercase tracking-wider text-xs">Catégorie</th>
              <th scope="col" class="px-6 py-4 font-semibold uppercase tracking-wider text-xs">Prix</th>
              <th scope="col" class="px-6 py-4 font-semibold uppercase tracking-wider text-xs">Performance</th>
              <th scope="col" class="px-6 py-4 font-semibold uppercase tracking-wider text-xs">Statut</th>
              <th scope="col" class="px-6 py-4 font-semibold uppercase tracking-wider text-xs text-right">Actions</th>
            </tr>
            </thead>
            <tbody class="divide-y divide-slate-100 bg-white">
            <tr *ngFor="let f of filteredFormations()" class="hover:bg-slate-50 transition-colors group">

              <!-- Course Info -->
              <td class="px-6 py-4">
                <div class="flex items-center">
                  <div class="h-12 w-16 flex-shrink-0 overflow-hidden rounded-lg bg-slate-100 border border-slate-200">
                    <img [src]="f.image || 'assets/default.png'"
                         class="h-full w-full object-cover"
                         onerror="this.src='https://placehold.co/100x80/e2e8f0/94a3b8?text=IMG'">
                  </div>
                  <div class="ml-4">
                    <div class="font-bold text-slate-900 group-hover:text-indigo-600 transition-colors">{{ f.titre }}</div>
                    <div class="text-xs text-slate-500">MAJ : {{ f.derniereMiseAJour | date:'dd MMM yyyy' }}</div>
                  </div>
                </div>
              </td>

              <!-- Catégorie -->
              <td class="px-6 py-4">
                  <span class="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium"
                        [ngClass]="getCategoryColor(f.categorieName)">
                    {{ f.categorieName }}
                  </span>
              </td>

              <!-- Prix -->
              <td class="px-6 py-4 font-semibold text-slate-700">
                {{ f.prix | currency:'EUR':'symbol':'1.0-0' }}
              </td>

              <!-- Stats & Progress -->
              <td class="px-6 py-4">
                <div class="flex flex-col gap-1 w-32">
                  <div class="flex justify-between text-xs text-slate-500">
                    <span>{{ f.nbInscrits }} élèves</span>
                    <span class="flex items-center text-amber-500 font-bold">
                        {{ f.noteMoyenne | number:'1.1-1' }} ★
                      </span>
                  </div>
                  <div class="h-1.5 w-full rounded-full bg-slate-100 overflow-hidden">
                    <div class="h-full rounded-full bg-indigo-500 transition-all duration-500"
                         [style.width.%]="f.tauxCompletion"></div>
                  </div>
                </div>
              </td>

              <!-- Switch Toggle Status -->
              <td class="px-6 py-4">
                <button (click)="togglePublish(f)"
                        class="relative inline-flex h-6 w-11 flex-shrink-0 cursor-pointer rounded-full border-2 border-transparent transition-colors duration-200 ease-in-out focus:outline-none focus:ring-2 focus:ring-indigo-600 focus:ring-offset-2"
                        [ngClass]="f.publier ? 'bg-emerald-500' : 'bg-slate-200'">
                  <span class="sr-only">Publier</span>
                  <span aria-hidden="true"
                        class="pointer-events-none inline-block h-5 w-5 transform rounded-full bg-white shadow ring-0 transition duration-200 ease-in-out"
                        [ngClass]="f.publier ? 'translate-x-5' : 'translate-x-0'"></span>
                </button>
                <span class="ml-2 text-xs font-medium"
                      [ngClass]="f.publier ? 'text-emerald-600' : 'text-slate-400'">
                    {{ f.publier ? 'En ligne' : 'Off' }}
                  </span>
              </td>

              <!-- Actions -->
              <td class="px-6 py-4 text-right">
                <div class="flex items-center justify-end gap-2">
                  <button (click)="editFormation(f.id)"
                          class="p-2 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors"
                          title="Modifier">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
                  </button>
                  <button (click)="deleteFormation(f)"
                          class="p-2 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                          title="Supprimer">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                  </button>
                </div>
              </td>
            </tr>
            </tbody>
          </table>

          <!-- Empty State -->
          <div *ngIf="filteredFormations().length === 0" class="flex flex-col items-center justify-center py-16 text-center">
            <div class="rounded-full bg-slate-100 p-4 mb-4">
              <svg class="w-8 h-8 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
            </div>
            <h3 class="text-sm font-medium text-slate-900">Aucun résultat</h3>
            <p class="mt-1 text-sm text-slate-500">Essayez de modifier vos filtres ou votre recherche.</p>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
