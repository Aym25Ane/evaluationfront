@if (formation) {
  <!-- Header Fixe -->
  <div class="explorer-header">
    <span class="header-title">PLAN DU COURS</span>
    <button class="btn-icon-add" (click)="addCours.emit()" title="Ajouter un module">
      <i class="bi bi-plus-lg"></i>
    </button>
  </div>

  <div class="tree-container custom-scrollbar">

    <!-- 1. FORMATION (Racine) -->
    <div class="tree-node root-node"
         [class.active]="isSelected(formation)"
         (click)="selectItem($event, formation)">

      <div class="node-content">
        <i class="bi bi-mortarboard-fill node-icon text-primary"></i>
        <span class="node-label">{{ formation.titre || 'Nouvelle Formation' }}</span>
      </div>

      <!-- Pas d'actions pour la racine (ou ajouter selon besoin) -->
    </div>

    <!-- 2. COURS (Modules) -->
    <div class="branch-guide root-branch">
      @for (cours of formation.cours; track cours.id) {
        <div class="tree-group">

          <div class="tree-node course-node"
               [class.active]="isSelected(cours)"
               (click)="selectItem($event, cours)">

            <div class="node-content">
              <i class="bi bi-folder-fill node-icon text-course"></i>
              <span class="node-label">{{ cours.titre || 'Nouveau Module' }}</span>
            </div>

            <div class="node-actions">
              <button class="action-btn add" (click)="addChapitre.emit(cours); $event.stopPropagation()" title="Ajouter un chapitre">
                <i class="bi bi-plus"></i>
              </button>
              <button class="action-btn delete" (click)="removeCours.emit(cours); $event.stopPropagation()" title="Supprimer">
                <i class="bi bi-trash3"></i>
              </button>
            </div>
          </div>

          <!-- 3. CHAPITRES -->
          <div class="branch-guide">
            @for (chapitre of cours.chapitres; track chapitre.id) {
              <div class="tree-group">

                <div class="tree-node chapter-node"
                     [class.active]="isSelected(chapitre)"
                     (click)="selectItem($event, chapitre)">

                  <div class="node-content">
                    <i class="bi bi-journal-text node-icon text-chapter"></i>
                    <span class="node-label">{{ chapitre.titre || 'Nouveau Chapitre' }}</span>
                  </div>

                  <div class="node-actions">
                    <button class="action-btn add" (click)="addSection.emit(chapitre); $event.stopPropagation()" title="Ajouter du contenu">
                      <i class="bi bi-plus"></i>
                    </button>
                    <button class="action-btn delete" (click)="removeChapitre.emit({chapitre: chapitre, parentCours: cours}); $event.stopPropagation()" title="Supprimer">
                      <i class="bi bi-trash3"></i>
                    </button>
                  </div>
                </div>

                <!-- 4. SECTIONS (Leçons) -->
                <div class="branch-guide">
                  @for (section of chapitre.sections; track section.id) {
                    <div class="tree-node section-node"
                         [class.active]="isSelected(section)"
                         (click)="selectItem($event, section)">

                      <div class="node-content">
                        <!-- Icône dynamique selon le type (VIDEO, IMAGE, TEXTE) -->
                        @if(section.typeContenu === 'VIDEO') {
                          <i class="bi bi-play-circle node-icon text-section" title="Vidéo"></i>
                        }
                        @else if(section.typeContenu === 'IMAGE') {
                          <i class="bi bi-image node-icon text-section" title="Image"></i>
                        }
                        @else {
                          <!-- Par défaut : TEXTE -->
                          <i class="bi bi-file-text node-icon text-section" title="Texte"></i>
                        }

                        <span class="node-label">{{ section.titre || 'Nouvelle Leçon' }}</span>
                      </div>
                      <div class="node-actions">
                        <button class="action-btn delete" (click)="removeSection.emit({section: section, parentChapitre: chapitre}); $event.stopPropagation()" title="Supprimer">
                          <i class="bi bi-trash3"></i>
                        </button>
                      </div>
                    </div>
                  }
                </div>

              </div>
            }
          </div>

        </div>
      }
    </div>
  </div>
}
